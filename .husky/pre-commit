#!/bin/sh

echo "ğŸ” Pre-commit ê²€ì‚¬ ì‹¤í–‰ ì¤‘..."

# 1. ì‹œí¬ë¦¿ í‚¤ íŒ¨í„´ ê²€ì‚¬
echo "  â†’ ì‹œí¬ë¦¿ í‚¤ íŒ¨í„´ ê²€ì‚¬..."
SECRETS_FOUND=$(grep -rn "AKID\|AIzaSy\|sk-\|supabase.*key.*=.*ey" \
  --include="*.ts" --include="*.tsx" --include="*.js" \
  src/ 2>/dev/null | grep -v "process\.env\|secrets\.\|\.example\|\.d\.ts\|// " || true)

if [ -n "$SECRETS_FOUND" ]; then
  echo "âš ï¸  ì‹œí¬ë¦¿ í‚¤ê°€ ì½”ë“œì— í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤!"
  echo "$SECRETS_FOUND"
  exit 1
fi

echo "  âœ… ì‹œí¬ë¦¿ í‚¤ ì—†ìŒ"

# 2. ESLint ê²€ì‚¬ (ìŠ¤í…Œì´ì§•ëœ íŒŒì¼ë§Œ)
echo "  â†’ ESLint ê²€ì‚¬ (lint-staged)..."
npx lint-staged

echo "âœ… ëª¨ë“  ê²€ì‚¬ í†µê³¼!"
